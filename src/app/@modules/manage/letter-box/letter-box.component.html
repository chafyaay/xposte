<app-spinner></app-spinner>
<div class="container pd20">
  <div class="wrapper-title flex">
    <h1 class="main-title">{{ 'BOITES_AUX_LETTRES' | translate }}</h1>
    <button class="main-btn icon" (click)="openFormulaire()">
      {{ 'CREER_BAL' | translate }}
    </button>
  </div>

  <!--modal tamponnage -->
  <app-template-modal *ngIf="isModalOpen" [TitleModal]="TitleModal" [isModalOpen]="isModalOpen" [isValid]="true"
    (isModalClose)="modalCloseTamponnage($event)" (valide)="valideTempo($event)">
    <app-temponnage [temponnageSelecte]="balTamponNbr" [balTemponne]="selectedBal" [balFilter]="balFilter"
      [balDataList]="balDataList">
    </app-temponnage>
  </app-template-modal>
  <!-- ======= END .Bloc TILTE & BUTTON ======= -->

  <!-- remise à disposition notificarion -->
  <!-- yassine chafyaay -->
  <app-notification class="app-notification"
    [notificationColor]="openNotifRemiseDispoError? 'alerteMessage': notificationColor"
    (closeNotfification)="resetNotificationDataAndClose()" *ngIf="openNotifRemiseDispoSuccess">
    <ng-container *ngIf="openNotifRemiseDispoSuccess">
      <h3 class="message_title">
        {{openNotifRemiseDispoSuccess? ('REMISE_DISPO_NOTIFICATION_SUCCES' | translate):
        ('REMISE_DISPO_NOTIFICATION_FAIL' | translate)}}
      </h3>
      <ul class="flex">
        <li> {{ 'REMISE-DISPO_BAL' | translate }} :
          {{ selectedBal.length === 0 ? totalResult : selectedBal.length }}</li>
        <li *ngFor="let msg of REMISE_DISP_NOTIF_MSG" class="flex">
          <div>{{msg.label | translate}} :</div>
          <div>{{msg.value | titlecase}}</div>
        </li>
      </ul>
    </ng-container>

    <ng-container *ngIf="openNotifRemiseDispoError">
      {{ 'REMISE_DISPO_NOTIFICATION_FAIL' | translate }}   
    </ng-container>
  </app-notification>

  <!--notification de tamponnage -->
  <app-notification *ngIf="
      openNotifDetemponnageSucces ||
      openNotifTemponnage ||
      openNotifTemponnageError ||
      isModMassbalsSuccess ||
      isModMassbalsFail ||
      openNotifDescativerMassSuccess ||
      openNotifDescativerMassSuccess
    " [notificationColor]="
      openNotifTemponnageError ||
      isModMassbalsFail ||
      openNotifRemiseDispoSuccess ||
      openNotifRemiseDispoError ||
      openNotifDescativerMassFail ||
      openNotifTemponnageError
        ? 'alerteMessage'
        : notificationColor
    " (closeNotfification)="resetNotificationDataAndClose()">
    <ng-container *ngIf="openNotifTemponnageError">
      <h3 class="message_title">{{ 'TAMPO_FAILURE' | translate }}</h3>
      {{ messageErrorTamponnage }}
    </ng-container>

    <ng-container *ngIf="openNotifDetemponnageSucces">
      <h3 class="message_title">
        {{
        openNotifDetemponnageSucces
        ? ('DETAMPON_NOTIFICATION_SUCCES' | translate)
        : ('DETAMPON_NOTIFICATION_FAIL' | translate)
        }}
      </h3>
      <ul>
        <li>
          {{ 'DETAMPO_BAL' | translate }} :
          {{ balTamponNbr }}&nbsp;&nbsp;&nbsp;|
        </li>
        <li>
          {{ 'CRITERE_DETAMPO_LABEL' | translate }}
          <ng-container *ngIf="BalTamponner.etatBal">
            &nbsp; {{ 'ETAT' | translate }}&nbsp;:&nbsp;
            <div>
              {{ BalTamponner.etatBal }}
            </div>
          </ng-container>&nbsp;&nbsp;&nbsp;&nbsp;
          <ng-container *ngIf="BalTamponner.adresseBal">
            &nbsp;{{ 'ADRESS' | translate }}&nbsp;:&nbsp;
            <div>
              <span class="">{{ BalTamponner.adresseBal }}</span>
            </div>
            &nbsp;&nbsp;&nbsp;&nbsp;
          </ng-container>
          <ng-container *ngIf="BalTamponner.identifiantFrontal">
            &nbsp;{{ 'FRONTAL' | translate }}&nbsp;:&nbsp;
            <div>
              <span class="">{{ BalTamponner.identifiantFrontal }}</span>
            </div>
            &nbsp;&nbsp;&nbsp;&nbsp;
          </ng-container>
        </li>
      </ul>
    </ng-container>

    <ng-container *ngIf="openNotifTemponnage">
      <h3 class="message_title">
        {{ 'TEMPO_LANCE_WITH_SUCCESS' | translate }}
      </h3>
      <ul>
        <li>
          {{ 'BAL Tamponnées :' | translate }}
          {{ balTamponNbr }}&nbsp;&nbsp;&nbsp;|
        </li>
        <li *ngIf="BalTamponner.etatBal">
          {{ 'CRITERE_TEMPO' | translate }}&nbsp;&nbsp;
          <div>
            &nbsp; {{ 'ETAT' | translate }} &nbsp;:&nbsp;
            {{ BalTamponner.etatBal }}
          </div>
        </li>
        <li *ngIf="BalTamponner.adresseBal">
          &nbsp;{{ 'ADRESS' | translate }} &nbsp;:&nbsp;
          <div>
            <span class="">{{ BalTamponner.adresseBal }}</span>
          </div>
        </li>
        <li *ngIf="BalTamponner.identifiantFrontal">
          &nbsp;{{ 'FRONTAL' | translate }} &nbsp;:&nbsp;
          <div>
            <span class="">{{ BalTamponner.identifiantFrontal }}</span>
          </div>
        </li>
      </ul>
    </ng-container>

    <ng-container *ngIf="openNotifDetemponnageFail">
      {{ notificationErrorMessage }}
    </ng-container>
    <!-- show Desctiver en mass  notification  -->
    <ng-container *ngIf="openNotifDescativerMassSuccess">
      <h3 class="message_title">
        {{
        openNotifDescativerMassSuccess
        ? ('DES_MASS_NOTIF_MSG_SUCCESS' | translate)
        : ('DES_MASS_NOTIF_MSG_FAIL' | translate)
        }}
      </h3>
      <ul class="flex">
        <li class="notif-items">
          {{ 'DES_MASS_NOTIF_BALS_MOD' | translate }} :
          {{ selectedBal.length === 0 ? totalResult : selectedBal.length }}
        </li>
        <li class="notif-items">
          {{ 'ETAT' | translate }} : {{ balFilter.etatBal }}
        </li>
        <li *ngFor="let msg of DESACTIVER_EN_MASS_NOTIF_MSGs" class="felx">
<div>{{ msg.label | translate }} : </div>
<div>{{ msg.value }}</div>
        </li>
      </ul>
    </ng-container>
    <ng-container *ngIf="openNotifDescativerMassFail">
      {{ 'DESACTIVATION_MASS_NOTIFICATION_FAIL' | translate }}
    </ng-container>
    <!-- show Modification en mass  notification  -->
    <ng-container *ngIf="isModMassbalsSuccess">
      <h3 class="message_title">
        {{
        isModMassbalsSuccess
        ? ('MOD_MASS_NOTIF_MSG_SUCCESS' | translate)
        : ('REMISE_DISPO_NOTIFICATION_FAIL' | translate)
        }}
      </h3>
      <ul class="flex">
        <li class="notif-items">
          {{ 'MOD_MASS_NOTIF_BALS_MOD' | translate }} :
          {{ selectedBal.length === 0 ? totalResult : selectedBal.length }}
        </li>
        <li *ngFor="let msg of MODIF_MASS_NOTIF_MSGs" class="flex">
          <div>{{msg.label | translate}} : </div>
          <div>{{msg.value}}</div>
        </li>
      </ul>
    </ng-container>
    <ng-container *ngIf="isModMassbalsFail">
      {{ 'MODIF_MASS_NOTIFICATION_FAIL' | translate }}
    </ng-container>
    <!-- show remise disposition notification  -->
  </app-notification>

  <!--notification de Creation de BAL -->
  <app-notification *ngIf="openNotifBalCreationSucces || openNotifBalCreationFail"
    [notificationColor]="openNotifBalCreationFail ? 'alerteMessage' : 'message'"
    (closeNotfification)="resetNotificationDataAndClose()">
    <h3 class="message_title">
      {{
      openNotifBalCreationSucces
      ? ('BAL_CREATION_NOTIFICATION_SUCCES' | translate)
      : ('BAL_CREATION_NOTIFICATION_FAIL' | translate)
      }}
    </h3>
    <ng-container *ngIf="openNotifBalCreationSucces || openNotifRemiseDispoSuccess">
      <ul>
        <li>
          {{ 'ADDRESS' | translate }} :
          {{ newBal?.adresseBal }}
        </li>
        <li>
          &nbsp; {{ 'FRONTAL' | translate }} :
          {{ newBal?.frontal?.nom }}
        </li>
        <li>
          &nbsp; {{ 'BAL_TYPE_CREATION_LABEL' | translate }} :
          {{ newBal?.typeBal }}
        </li>
        <li>
          &nbsp; {{ 'SEUIL' | translate }} :
          {{ newBal?.seuil }}
        </li>
        <li>
          &nbsp; {{ 'IPS' | translate }} :
          {{ newBal?.listeAdressesIPAutorises?.join(',') }}
        </li>
        <li>
          {{ 'MAIL_ALERTE' | translate }} :
          {{ newBal?.adresseMailAlerte }}
        </li>
        <li *ngIf="newBal?.relaisMessagerie">
          {{ 'RELAI_MESSAGERIE' | translate }} :
          {{ newBal?.relaisMessagerie }}
        </li>
      </ul>
    </ng-container>
    <ng-container *ngIf="openNotifBalCreationFail">
      {{ notificationErrorMessage }}
    </ng-container>
  </app-notification>
  <app-notification *ngIf="openNotifBalUpdateSucces || openNotifBalUpdateFail" [notificationColor]="
      openNotifBalUpdateFail ? 'message notification-error-color' : 'message'
    " (closeNotfification)="resetNotificationDataAndClose()">
    <h3 class="message_title">
      {{
      openNotifBalUpdateSucces
      ? ('BAL_MODIFICATION_NOTIFICATION_SUCCES' | translate)
      : ('BAL_MODIFICATION_NOTIFICATION_FAIL' | translate)
      }}
    </h3>
    <ng-container *ngIf="openNotifBalUpdateSucces">
      <ul>
        <li>
          {{ 'ADDRESS' | translate }} :
          {{ updatedBal?.adresseBal }}
        </li>
        <li>
          &nbsp; {{ 'FRONTAL' | translate }} :
          <div>
            {{ updatedBal?.frontal?.nom }}
          </div>
        </li>
        <li>
          &nbsp; {{ 'BAL_TYPE_CREATION_LABEL' | translate }} :
          <div>
            <span class="">{{ updatedBal?.typeBal }}</span>
          </div>
        </li>
        <li>
          &nbsp; {{ 'SEUIL' | translate }} :
          <div>
            <span class="">{{ updatedBal?.seuil }}</span>
          </div>
        </li>
        <li>
          &nbsp; {{ 'IPS' | translate }} :
          <div>
            <span class="">{{
              updatedBal?.listeAdressesIPAutorises?.join(',')
              }}</span>
          </div>
        </li>
        <li>
          {{ 'MAIL_ALERTE' | translate }} :
          <div>
            <span class="">{{ updatedBal?.adresseMailAlerte }}</span>
          </div>
        </li>
        <li *ngIf="updatedBal?.relaisMessagerie">
          {{ 'RELAI_MESSAGERIE' | translate }} :
          <div>
            <span class="">{{ updatedBal?.relaisMessagerie }}</span>
          </div>
        </li>
      </ul>
    </ng-container>
    <ng-container *ngIf="openNotifBalUpdateFail">
      {{ notificationErrorMessage }}
    </ng-container>
  </app-notification>
  <!-- ======= START .Bloc FILTRES ======= -->
  <app-filter #balFilterComp [inputFilterData]="inputFilterDataNew" [filtreType]="FiltreType.BAL"
    (filterEvent)="getFiltredData($event)" (frontalAutocompletEvent)="getFrontalData($event)"
    (filterDefaultEvent)="getFiltredDataDefault()"></app-filter>

  <!-- ======= END .Bloc FILTRES ======= -->

  <div class="flex space-between mgb40">
    <app-pagination [titlePagination]="'MAIL_BOXS' | translate" [totalResult]="totalResult"
      [pageNumber]="balFilter.numeroPage" [pageSiz]="balFilter.nbResultatsParPage"
      (paginationChangeEvent)="getPagination($event)"></app-pagination>

    <div class="flex buttons-container">
      <button *ngIf="showRemiseDispositionBtn" class="main-btn btn-second" (click)="openRemiseDispositionModal()">
        {{ 'MAKE_AVAILABALITY_BTN' | translate }}
        {{ selectedBal.length === 0 ? totalResult : selectedBal.length }} BALs
      </button>

      <button *ngIf="showDetamponnage" class="main-btn btn-second" (click)="openModalDetampo()">
        {{ 'DETAMPON' | translate }}
        {{ selectedBal.length === 0 ? totalResult : selectedBal.length }} BALs
      </button>

      <button *ngIf="isShowTemponnage" class="main-btn btn-second" (click)="openModalTempo()">
        {{ 'Tamponner' | translate }}
        {{ selectedBal.length === 0 ? totalResult : selectedBal.length }}
        {{ 'BALs' | translate }}
      </button>

      <!-- yassine chafyaay -->
      <!-- modifier masse bals button -->
      <div class="modifier-mass-bals mbt20">
        <i class="zmdi zmdi-edit"></i>
        <ng-select class="main-btn btn-second" selectedLabel="" [items]="tempSelectedItems" bindLabel="label"
          bindValue="id" (change)="openSidebarCanvas($event)"></ng-select>
      </div>

      <app-template-formulaire *ngIf="isModMassbalsSidBarCanvasOpen"
        [titleFormulaire]="'MOD_MASS_NOTIF_TITLE' | translate" [isFormulaireopen]="isModMassbalsSidBarCanvasOpen"
        (closeFormulaire)="CloseCreateBALForm()">
        <app-modifier-masse-bals (closeEvent)="closeEventHandler($event)" 
        [balDataList]="balDataList" 
        [selectedBal]="selectedBal"
        [etatBal]="balFilter.etatBal"
        [filtreAdresse]="adresseHighlight"
        [identifiantFrontal]="balFilter.identifiantFrontal"
        
          (MODIF_EN_MASS_EVENT_EMITTER)="MODIF_EN_MASS_EVENT_HANDLER($event)" 
          [balNumber]="
            selectedBal.length === 0 ? totalResult : selectedBal.length
          " [selectedBal]="selectedBal">
        </app-modifier-masse-bals>
      </app-template-formulaire>
    </div>
  </div>
  <!-- ======= START .Bloc MAIN TABLE ======= -->
  <app-letter-box-list #balList [highlighRowEnable]="highlighRowEnable" [frontalRefs]="inputFilterData.frontal"
    [listBAL]="balDataList" [highlight]="highlight" [adresseHighlight]="adresseHighlight"
    [selectedBALList]="selectedBal" (selectedBALEvent)="saveSelectedBAL($event)" (orderingFilter)="updateOrder($event)"
    (updateBALEvent)="editBal($event)"></app-letter-box-list>

  <app-template-formulaire *ngIf="isFormulaireopen" [titleFormulaire]="TitleFormulaire"
    [isFormulaireopen]="isFormulaireopen" (closeFormulaire)="CloseCreateBALForm()">
    <app-formulaire (closeEvent)="CloseCreateBALForm()" (valideCreateBal)="createNewBAL($event)"></app-formulaire>
  </app-template-formulaire>
  <!--formulaire de modification de bal -->
  <app-template-formulaire *ngIf="isUpdateBalFormOpen" [titleFormulaire]="'EDITE_BAL_FORM_TITLE' | translate"
    [isFormulaireopen]="isUpdateBalFormOpen" (closeFormulaire)="closeUpdateForm()">
    <app-update-bal (closeEvent)="closeUpdateForm()" (valideUpdateBal)="updateBal($event)" [bal]="updatedBal">
    </app-update-bal>
  </app-template-formulaire>
  <div class="overley" [ngClass]="
      isUpdateBalFormOpen || isFormulaireopen || isModalOpen ? 'show' : ''
    "></div>

  <app-template-modal *ngIf="isModalDetampoOpen" [TitleModal]="'DETAMPO_MODAL_TITLE' | translate"
    [isModalOpen]="isModalDetampoOpen" [isValid]="true" (isModalClose)="closeModalDetampo($event)"
    (valide)="valideDeTempo($event)">
    <app-detamponnage [balTemponne]="selectedBal" [balFilter]="balFilter"
      [balNumber]="selectedBal.length === 0 ? totalResult : selectedBal.length" [tooltipBALs]="tooltipBALs"
      [balDataList]="balDataList"></app-detamponnage>
  </app-template-modal>
  <!-- remise a disposition -->

      <app-template-modal
      *ngIf="showRemiseDispositionModal"
      [TitleModal]="'REMETTRE_DISPO_MODAL_TITLE' | translate"
      [isModalOpen]="showRemiseDispositionModal"
      [isValid]="isFormValid"
      (isModalClose)="closeRemiseDispositionModal($event)" (valide)="remise_dispo_submit($event)">
      <app-remise-disposition 
      [balDataList]="balDataList" 
      [selectedBal]="selectedBal"
      [balNumber]="selectedBal.length === 0 ? totalResult : selectedBal.length"
        (remiseDispoEvent)="REMISE_DISPO_EVENT_HANDLER($event)"></app-remise-disposition>
        
      </app-template-modal>

  <!-- desactiver en masse -->
  <!-- author yassine  -->
  <app-template-modal *ngIf="openDescativerEnMassModal" [TitleModal]="'DES_MODAL_TITLE' | translate"
    [isModalOpen]="openDescativerEnMassModal" [isValid]="isDesactiverEnMassFormvalid"
    (isModalClose)="closeDesactiverEnMassModal($event)" (valide)="desactiver_en_mass_submit($event)">
    <app-desactiver-en-mass [selectedBal]="selectedBal"
      [balNumber]="selectedBal.length === 0 ? totalResult : selectedBal.length" [balFilter]="balFilter"
      [balDataList]="balDataList" (DESACTIVER_EN_MASS_EVENT)="DESACTIVER_EN_MASS_EVENT_HANDLER($event)">
    </app-desactiver-en-mass>
  </app-template-modal>

  <div class="flex space-between mgb40">
    <app-pagination *ngIf="isShowPagiantion" [titlePagination]="'MAIL_BOXS' | translate" [totalResult]="totalResult"
      [pageNumber]="balFilter.numeroPage" [pageSiz]="balFilter.nbResultatsParPage"
      (paginationChangeEvent)="getPagination($event)"></app-pagination>
  </div>
</div>