<div [formGroup]="miseDispoForm" class="app-remise-dispo pd20">
  <div class="flex">
    <div class="totalInbox mgb30">
      <span class="val">{{ balNumber }}</span>
      {{ 'BOITES_AUX_LETTRES' | translate }}
    </div>

    <div class="info-bulle">
      <app-info-bulle
        [balDataList]="selectedBal.length > 0 ? selectedBal : balDataList"
        [selectedBal]="selectedBal"
      ></app-info-bulle>
    </div>
  </div>
  <h4 class="title_modal mgb10">
    {{ 'REMETTRE_DISPO_CRITERE_TITLE' | translate }}
  </h4>
  <!-- periode -->
  <h3 class="title_modal mgt40">{{ 'REMETTRE_DISPO_PERIODE' | translate }}</h3>
  <div class="period-container flex mgt20">
    <app-date-time-picker
      (keyupEvent)="periodeKeyUphandler($event, 'dd')"
      [isPeriod]="true"
      label="{{ 'REMETTRE_DISPO_DATE_DEBUT' | translate }}"
      (datetimevalueEvent)="onPeriodeSelect($event, 'dd')"
      formControlName="dateHeureDebut"
      name="dateHeureDebut"
    ></app-date-time-picker>
    <app-date-time-picker
      (keyupEvent)="periodeKeyUphandler($event, 'df')"
      [isPeriod]="true"
      class="mgl20"
      label="{{ 'REMETTRE_DISPO_DATE_FIN' | translate }}"
      (datetimevalueEvent)="onPeriodeSelect($event, 'df')"
      formControlName="dateHeureFin"
      name="dateHeureFin"
    ></app-date-time-picker>
    <input type="hidden" formControleName="periode" name="" />
  </div>
  <span
    *ngIf="
      (form.get('dateHeureDebut').touched ||
        form.get('dateHeureFin').touched) &&
      !this.isPeriodValid
    "
    class="helptext text-red"
    >{{ 'SUBFIELDS.DATE_ERR_INV' | translate }}</span
  >
  <!-- list des messages  lus  -->
  <div class="select-field field-lists flex mgt40">
    <div class="inputField" style="flex-grow: 1">
      <ng-select
        [items]="TEMP_FIELD_LISTS.message_lus_list"
        bindLabel="label"
        bindValue="id"
        placeholder="Etat"
        name="filterField"
        class="ngselectCustom"
        (change)="selectFieldHandler($event, 'message_lus')"
        (focus)="isMessageLusListSelected = true"
      >
      </ng-select>
      <label
        for="Critères de recherche du message"
        [ngClass]="isMessageLusListSelected ? 'ng-select-label' : ''"
      >
        {{ 'REMETTRE_DISPO_FILTER_1' | translate }}
      </label>
    </div>
    <button
      class="main-btn icon mgl20"
      [disabled]="!isMessageLuAddItem"
      (click)="INSERT_FIELD()"
    >
      {{ 'AJOUTER_CRITERE' | translate }}
    </button>
  </div>

  <div *ngFor="let field of TEMP_FIELD_LISTS.message_lus_list">
    <div *ngIf="field.disabled" class="sub-field">
      <div class="inputField">
        <ng-container [ngSwitch]="field.type">
          <ng-template [ngSwitchCase]="'text'">
            <input
              #messageLuField
              formControlName="{{ field.fcn }}"
              type="text"
              [name]="field.fcn"
              (keyup)="onKeyUp($event, field.fcn)"
              (change)="onChange($event, field.fcn)"
              placeholder=" "
            />
          </ng-template>
          <ng-template [ngSwitchCase]="'list'">
            <ng-select
              formControlName="{{ field.fcn }}"
              [items]="field.data"
              bindLabel="label"
              bindValue="id"
              class="ngselectCustom"
              (change)="onsSelectField($event, field.fcn)"
              (focus)="onFieldFocus($event, field.id)"
            >
            </ng-select>
          </ng-template>
        </ng-container>
        <label for="field.label" *ngIf="!(field.id === 4 || field.id === 5)">
          {{ field.label }}
        </label>
        <label
          for="field.label"
          *ngIf="field.id === 4"
          [ngClass]="fichierCompresseeSelected ? 'ng-select-label' : ''"
        >
          {{ field.label }}
        </label>
        <label
          for="field.label"
          *ngIf="field.id === 5"
          [ngClass]="fichierChifreeSelected ? 'ng-select-label' : ''"
        >
          {{ field.label }}
        </label>
      </div>
      <button class="remove" (click)="REMOVE_FIELD(field)">
        <i class="zmdi zmdi-delete"></i>
      </button>
    </div>
    <span
      class="helptext text-red"
      *ngIf="
        form.get(field.fcn).touched &&
        field.disabled &&
        form.get(field.fcn).invalid
      "
      >Champ Invalid</span
    >
  </div>

  <!-- list des messages  lus  -->

  <div class="select-field field-lists flex mgt40">
    <div class="inputField" style="flex-grow: 1">
      <ng-select
        [items]="TEMP_FIELD_LISTS.sujet_list"
        bindLabel="label"
        bindValue="id"
        placeholder="Etat"
        name="filterField"
        class="ngselectCustom"
        (change)="selectFieldHandler($event, 'sujet_list')"
        (focus)="isSujetLusListSelected = true"
      >
      </ng-select>
      <label
        for="Critères de recherche du message"
        [ngClass]="isSujetLusListSelected ? 'ng-select-label' : ''"
      >
        {{ 'REMETTRE_DISPO_FILTER_2' | translate }}
      </label>
    </div>
    <button
      class="main-btn icon mgl20"
      [disabled]="!isSujetAddItem"
      (click)="INSERT_FIELD()"
    >
      {{ 'AJOUTER_CRITERE' | translate }}
    </button>
  </div>

  <div *ngFor="let field of TEMP_FIELD_LISTS.sujet_list">
    <div *ngIf="field.disabled" class="sub-field">
      <div class="inputField">
        <ng-container [ngSwitch]="field.type">
          <ng-template [ngSwitchCase]="'text'">
            <input
              id="{{ field.fcn }}"
              formControlName="{{ field.fcn }}"
              type="text"
              [name]="field.fcn"
              value="{{ form.get(field.fcn).value }}"
              (keyup)="onKeyUp($event, field.fcn)"
              (change)="onChange($event, field.fcn)"
              (focus)="onFocus($event, field.fcn)"
              (keypress)="onKeyPress($event, field.fcn)"
              (blur)="onBlur($event, field.fcn)"
              placeholder=" "
            />
          </ng-template>
          <ng-template [ngSwitchCase]="'date'">
            <app-date-time-picker
              formControlName="{{ field.fcn }}"
              [isPeriod]="false"
              [label]="field.label"
              [label]="field.label"
              (datetimevalueEvent)="onsSelectDateTime($event, 'dateHeureSujet')"
              formControlName="dateHeureSujet"
              name="activeEndDate"
            >
            </app-date-time-picker>
          </ng-template>
        </ng-container>
        <label for="field.label" *ngIf="!(field.fcn === 'dateHeureSujet')">
          {{ field.label }}
        </label>
      </div>
      <button class="remove" (click)="REMOVE_FIELD(field)">
        <i class="zmdi zmdi-delete"></i>
      </button>
    </div>

    <span
      class="helptext text-red"
      *ngIf="field.touched && field.disabled && form.get(field.fcn).invalid"
      >Champ Invalid</span
    >
  </div>
</div>
