<app-spinner></app-spinner>
<div class="container pd20">
  <div class="wrapper-title flex">
    <h1 class="main-title">{{ 'BOITES_AUX_LETTRES' | translate }}</h1>
    <button class="main-btn icon" (click)="openFormulaire()">
      {{ 'CREER_BAL' | translate }}
    </button>
  </div>

  <!--modal tamponnage -->
  <app-template-modal *ngIf="isModalOpen" [TitleModal]="TitleModal" [isModalOpen]="isModalOpen"
    (isModalClose)="modalCloseTamponnage($event)" (valide)="valideTempo($event)">
    <app-temponnage [temponnageSelecte]="balTamponNbr" [balTemponne]="selectedBal" [balFilter]="balFilter">
    </app-temponnage>
  </app-template-modal>
  <!-- ======= END .Bloc TILTE & BUTTON ======= -->
  <!--notification de tamponnage -->
  <!-- desactiver en masse  -->
  <app-notification *ngIf="
      openNotifDetemponnageSucces ||
      openNotifRemiseDispoSuccess ||
      openNotifTemponnage ||
      openNotifTemponnageError ||
      isModMassbalsSuccess ||
      openNotifDescativerMassSuccess ||
      isModMassbalsFail
    " [notificationColor]="
      openNotifTemponnageError ||
      isModMassbalsFail ||
      openNotifRemiseDispoError ||
      openNotifRemiseDispoError ||
      openNotifDescativerMassFail ||
      openNotifTemponnageError
        ? 'alerteMessage'
        : notificationColor
    " (closeNotfification)="resetNotificationDataAndClose()">
    <ng-container *ngIf="openNotifTemponnageError">
      <h3 class="message_title">{{ 'TAMPO_FAILURE' | translate }}</h3>
      {{ messageErrorTamponnage }}
    </ng-container>

    <ng-container *ngIf="openNotifDetemponnageSucces">
      <h3 class="message_title">
        {{
        openNotifDetemponnageSucces
        ? ('DETAMPON_NOTIFICATION_SUCCES' | translate)
        : ('DETAMPON_NOTIFICATION_FAIL' | translate)
        }}
      </h3>
      <ul>
        <li>{{ 'DETAMPO_BAL' | translate }} : {{ balTamponNbr }}</li>
        <li>
          {{ 'CRITERE_DETAMPO_LABEL' | translate }} :
          <ng-container *ngIf="BalTamponner.etatBal">
            &nbsp; {{ 'ETAT' | translate }}:
            <div>
              {{ BalTamponner.etatBal }}
            </div>
          </ng-container>&nbsp;&nbsp;&nbsp;&nbsp;
          <ng-container *ngIf="BalTamponner.adresseBal">
            &nbsp;{{ 'ADRESS' | translate }}&nbsp;&nbsp;
            <div>
              <span class="">{{ BalTamponner.adresseBal }}</span>
            </div>
            &nbsp;&nbsp;&nbsp;&nbsp;
          </ng-container>
          <ng-container *ngIf="BalTamponner.identifiantFrontal">
            &nbsp;{{ 'FRONTAL' | translate }}&nbsp;&nbsp;&nbsp;&nbsp;
            <div>
              <span class="">{{ BalTamponner.identifiantFrontal }}</span>
            </div>
            &nbsp;&nbsp;&nbsp;&nbsp;
          </ng-container>
        </li>
      </ul>
    </ng-container>

    <ng-container *ngIf="openNotifTemponnage">
      <h3 class="message_title">
        {{ 'TEMPO_LANCE_WITH_SUCCESS' | translate }}
      </h3>
      <ul>
        <li>
          {{ 'BAL Tamponnées :' | translate }}
          {{ balTamponNbr }}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
        </li>
        <li *ngIf="BalTamponner.etatBal">
          {{ 'CRITERE_TEMPO' | translate }}
          <div>
            &nbsp; {{ 'ETAT' | translate }} &nbsp;
            {{ BalTamponner.etatBal }}
          </div>
        </li>
        <li *ngIf="BalTamponner.adresseBal">
          &nbsp;{{ 'ADRESS' | translate }} &nbsp;&nbsp;
          <div>
            <span class="">{{ BalTamponner.adresseBal }}</span>
          </div>
        </li>
        <li *ngIf="BalTamponner.identifiantFrontal">
          &nbsp;{{ 'FRONTAL' | translate }} &nbsp;&nbsp;
          <div>
            <span class="">{{ BalTamponner.identifiantFrontal }}</span>
          </div>
        </li>
      </ul>
    </ng-container>

    <ng-container *ngIf="openNotifDetemponnageFail">
      {{ notificationErrorMessage }}
    </ng-container>
    <ng-container *ngIf="isModMassbalsFail">
      {{ modMassErrMessage }}
    </ng-container>
    <!-- show Desctiver en mass  notification  -->
    <ng-container *ngIf="openNotifDescativerMassSuccess">
      <h3 class="message_title">
        {{
        isModMassbalsSuccess
        ? ('DES_MASS_NOTIF_MSG_SUCCESS' | translate)
        : ('DES_MASS_NOTIF_MSG_FAIL' | translate)
        }}
      </h3>
      <ul class="flex">
        <li class="notif-items">
          {{ 'DES_MASS_NOTIF_BALS_MOD' | translate }} :
          {{ selectedBal.length === 0 ? totalResult : selectedBal.length }}
        </li>
        <li *ngIf="balFilter.etatBal" class="notif-items">
          {{ 'ETAT' | translate }} : {{ balFilter.etatBal }}
        </li>
        <li *ngIf="balFilter.identifiantFrontal" class="notif-items">
          {{ 'FRONTAL' | translate }} : {{ balFilter.identifiantFrontal }}
        </li>

      </ul>
    </ng-container>
    <!-- show Modification en mass  notification  -->
    <ng-container *ngIf="isModMassbalsSuccess">
      <h3 class="message_title">
        {{
        isModMassbalsSuccess
        ? ('MOD_MASS_NOTIF_MSG_SUCCESS' | translate)
        : ('REMISE_DISPO_NOTIFICATION_FAIL' | translate)
        }}
      </h3>
      <ul class="flex">
        <li class="notif-items">
          {{ 'MOD_MASS_NOTIF_BALS_MOD' | translate }} :
          {{ selectedBal.length === 0 ? totalResult : selectedBal.length }}
        </li>
        <li *ngIf="modifMassObj.frontal" class="notif-items">
          {{ 'FRONTAL' | translate }} : {{ modifMassObj.frontal }}
        </li>
        <li *ngIf="modifMassObj.identifiantFrontal" class="notif-items">
          {{ 'TYPE_BOITE_LETTRE' | translate }} :
          {{ modifMassObj.identifiantFrontal }}
        </li>
        <li *ngIf="modifMassObj.seuil" class="notif-items">
          {{ 'SEUIL' | translate }} : {{ modifMassObj.seuil }}
        </li>
        <li *ngIf="modifMassObj.adressesIP" class="notif-items">
          {{ 'IPs' | translate }} : {{ modifMassObj.adressesIP.join(',') }}
        </li>
        <li *ngIf="modifMassObj.mailAlerte" class="notif-items">
          {{ 'EMAIL_ALERT' | translate }} : {{ modifMassObj.mailAlerte }}
        </li>
        <li *ngIf="modifMassObj.relaiMessagerie" class="notif-items">
          {{ 'RELAIS_MESSAGERIE' | translate }} :
          {{ modifMassObj.relaiMessagerie }}
        </li>
      </ul>
    </ng-container>
    <!-- show remise disposition notification  -->

    <ng-container *ngIf="openNotifRemiseDispoSuccess">
      <h3 class="message_title">
        {{
        openNotifRemiseDispoSuccess
        ? ('REMISE_DISPO_NOTIFICATION_SUCCES' | translate)
        : ('REMISE_DISPO_NOTIFICATION_FAIL' | translate)
        }}
      </h3>

      <ul class="flex notif-message">
        <li class="notif-items">
          {{ 'REMISE-DISPO_BAL' | translate }} :{{ selectedBal.length === 0 ? totalResult : selectedBal.length }}
        </li>
        <li class="notif-items">
          {{ 'ETAT' | translate }} : {{ REMISE_DISPO_OBJ.etatBal }}
        </li>
        <li *ngIf="REMISE_DISPO_OBJ.adresseBal" class="notif-items">
          {{ 'ADRESS' | translate }} : {{ REMISE_DISPO_OBJ.adresseBal }}
        </li>
        <li *ngIf="REMISE_DISPO_OBJ.identifiantFrontal" class="notif-items">
          {{ 'FRONTAL' | translate }} :
          {{ REMISE_DISPO_OBJ.identifiantFrontal }}
        </li>
        <li *ngIf="
            REMISE_DISPO_OBJ.dateHeureDebut && REMISE_DISPO_OBJ.dateHeureFin
          " class="notif-items">
          <div class="date-label">{{ 'REMETTRE_DISPO_DATE_DEBUT' | translate }} :
            {{
            REMISE_DISPO_OBJ.dateHeureDebut | date: 'EEEE d MMMM, h:mm'
            }}</div>
          <div class="date-label fin">{{ 'REMETTRE_DISPO_DATE_FIN' | translate }} :
            {{
            REMISE_DISPO_OBJ.dateHeureFin | date: 'EEEE d MMMM, h:mm'
            }}</div>
        </li>
        <li *ngIf="REMISE_DISPO_OBJ.emetteur">
          {{
            'SUBFIELDS.EMMETTEUR' | translate
            }}:{{REMISE_DISPO_OBJ.emetteur}}
          </li>
        <li *ngIf="REMISE_DISPO_OBJ.destinataire">
          {{
            'SUBFIELDS.DESITINATAIRE'| translate
            }}:{{REMISE_DISPO_OBJ.destinataire}}
          </li>
        <li *ngIf="REMISE_DISPO_OBJ.contentDescription">
          {{
            'SUBFIELDS.CONTENT_DESC'| translate
            }}:{{REMISE_DISPO_OBJ.contentDescription}}
          </li>
        <li *ngIf="REMISE_DISPO_OBJ.fichiersCompresses!=='null' || (REMISE_DISPO_OBJ.fichiersCompresses || !REMISE_DISPO_OBJ.fichiersCompresses)">
          {{
            'SUBFIELDS.FICHIER_COMPRESSEE'| translate
            }}:{{REMISE_DISPO_OBJ.fichiersCompresses?'Oui':'Non'}}
          </li>
        <li *ngIf="
        REMISE_DISPO_OBJ.fichiersChiffres===null||
        REMISE_DISPO_OBJ.fichiersChiffres===true||
        REMISE_DISPO_OBJ.fichiersChiffres===false
        ">
          {{
            'SUBFIELDS.FICHIER_CHIFFREE'| translate
            }}:
            {{REMISE_DISPO_OBJ.fichiersChiffres?'Oui':'Non'}}
            <span *ngIf="REMISE_DISPO_OBJ.fichiersChiffres===true">{{'SUBFIELDS.OUI' | translate}}</span>
            <span *ngIf="REMISE_DISPO_OBJ.fichiersChiffres===false">{{'SUBFIELDS.NON' | translate}}</span>
            <span *ngIf="REMISE_DISPO_OBJ.fichiersChiffres===null">{{'SUBFIELDS.INDIFFERENT' | translate}}</span>
          
          </li>
        <li *ngIf="REMISE_DISPO_OBJ.type">
          {{ 'SUBFIELDS.TYPE'| translate }}:{{REMISE_DISPO_OBJ.type}}
          </li>
        <li *ngIf="REMISE_DISPO_OBJ.version">
          {{ 'SUBFIELDS.VERSION'| translate }}:{{REMISE_DISPO_OBJ.version}}
          </li>
        <li *ngIf="REMISE_DISPO_OBJ.codeEmetteur">
          {{ 'SUBFIELDS.CODE_EMETTEUR'| translate }}:{{REMISE_DISPO_OBJ.codeEmetteur}}
          </li>
        <li *ngIf="REMISE_DISPO_OBJ.dateHeureSujet">
          {{ 'SUBFIELDS.DATE_HEURE_SUJET'| translate }}:{{REMISE_DISPO_OBJ.dateHeureSujet | date: 'EEEE d MMMM, h:mm'}}
          </li>
        <li *ngIf="REMISE_DISPO_OBJ.codeCompostage">
          {{ 'SUBFIELDS.CODE_COMPOSTAGE'| translate }}:{{REMISE_DISPO_OBJ.codeCompostage}}
          </li>
        <li *ngIf="REMISE_DISPO_OBJ.nbFSE">
          {{ 'SUBFIELDS.NBFSE'| translate }}:{{REMISE_DISPO_OBJ.nbFSE}}
          </li>
        <li *ngIf="REMISE_DISPO_OBJ.sujetOuReplyInTo">
          {{ 'SUBFIELDS.SUJET_OUT_REPLY_INFO'| translate }}:{{REMISE_DISPO_OBJ.sujetOuReplyInTo}}
          </li>
      </ul>
    </ng-container>

    <ng-container *ngIf="openNotifRemiseDispoError">
      {{ notificationErrorMessage }}
    </ng-container>
  </app-notification>
  <!--notification de Creation de BAL -->
  <app-notification *ngIf="openNotifBalCreationSucces || openNotifBalCreationFail"
    [notificationColor]="openNotifBalCreationFail ? 'alerteMessage' : 'message'"
    (closeNotfification)="resetNotificationDataAndClose()">
    <h3 class="message_title">
      {{
      openNotifBalCreationSucces
      ? ('BAL_CREATION_NOTIFICATION_SUCCES' | translate)
      : ('BAL_CREATION_NOTIFICATION_FAIL' | translate)
      }}
    </h3>
    <ng-container *ngIf="openNotifBalCreationSucces || openNotifRemiseDispoSuccess">
      <ul>
        <li>
          {{ 'ADDRESS' | translate }} :
          {{ newBal?.adresseBal }}
        </li>
        <li>
          &nbsp; {{ 'FRONTAL' | translate }} :
          {{ newBal?.frontal?.nom }}
        </li>
        <li>
          &nbsp; {{ 'BAL_TYPE_CREATION_LABEL' | translate }} :
          {{ newBal?.typeBal }}
        </li>
        <li>
          &nbsp; {{ 'SEUIL' | translate }} :
          {{ newBal?.seuil }}
        </li>
        <li>
          &nbsp; {{ 'IPS' | translate }} :
          {{ newBal?.listeAdressesIPAutorises?.join(',') }}
        </li>
        <li>
          &nbsp; {{ 'MAIL_ALERTE' | translate }} :
          {{ newBal?.adresseMailAlerte }}
        </li>
      </ul>
    </ng-container>
    <ng-container *ngIf="openNotifBalCreationFail">
      {{ notificationErrorMessage }}
    </ng-container>
  </app-notification>
  <app-notification *ngIf="openNotifBalUpdateSucces || openNotifBalUpdateFail" [notificationColor]="
      openNotifBalUpdateFail ? 'message notification-error-color' : 'message'
    " (closeNotfification)="resetNotificationDataAndClose()">
    <h3 class="message_title">
      {{
      openNotifBalUpdateSucces
      ? ('BAL_MODIFICATION_NOTIFICATION_SUCCES' | translate)
      : ('BAL_MODIFICATION_NOTIFICATION_FAIL' | translate)
      }}
    </h3>
    <ng-container *ngIf="openNotifBalUpdateSucces">
      <ul>
        <li>
          {{ 'ADDRESS' | translate }} :
          {{ updatedBal?.adresseBal?.toLowerCase() }}
        </li>
        <li>
          &nbsp; {{ 'FRONTAL' | translate }} :
          <div>
            {{ updatedBal?.frontal?.nom?.toLowerCase() }}
          </div>
        </li>
        <li>
          &nbsp; {{ 'BAL_TYPE_CREATION_LABEL' | translate }} :
          <div>
            <span class="">{{ updatedBal?.typeBal?.toLowerCase() }}</span>
          </div>
        </li>
        <li>
          &nbsp; {{ 'SEUIL' | translate }} :
          <div>
            <span class="">{{ updatedBal?.seuil }}</span>
          </div>
        </li>
        <li>
          &nbsp; {{ 'IPS' | translate }} :
          <div>
            <span class="">{{
              updatedBal?.listeAdressesIPAutorises?.join(',')
              }}</span>
          </div>
        </li>
        <li>
          &nbsp; {{ 'MAIL_ALERTE' | translate }} :
          <div>
            <span class="">{{
              updatedBal?.adresseMailAlerte?.toLowerCase()
              }}</span>
          </div>
        </li>
      </ul>
    </ng-container>
    <ng-container *ngIf="openNotifBalUpdateFail">
      {{ notificationErrorMessage }}
    </ng-container>
  </app-notification>
  <!-- ======= START .Bloc FILTRES ======= -->
  <app-filter #balFilterComp [inputFilterData]="inputFilterDataNew" [filtreType]="FiltreType.BAL"
    (filterEvent)="getFiltredData($event)" (frontalAutocompletEvent)="getFrontalData($event)"
    (filterDefaultEvent)="getFiltredDataDefault()"></app-filter>
  <!-- ======= END .Bloc FILTRES ======= -->
  <div class="flex space-between mgb40">
    <app-pagination [titlePagination]="'MAIL_BOXS' | translate" [totalResult]="totalResult"
      [pageNumber]="balFilter.numeroPage" [pageSiz]="balFilter.nbResultatsParPage"
      (paginationChangeEvent)="getPagination($event)"></app-pagination>

    <div class="flex buttons-container">
      <button *ngIf="showDetamponnage" class="main-btn btn-second" (click)="openModalDetampo()">
        {{ 'DETOMPON' | translate }}
        {{ selectedBal.length === 0 ? totalResult : selectedBal.length }} BALs
      </button>
      <button *ngIf="isShowTemponnage" class="main-btn btn-second" (click)="openModalTempo()">
        {{ 'Tamponner' | translate }}
        {{ selectedBal.length === 0 ? totalResult : selectedBal.length }}
        {{ 'BALs' | translate }}
      </button>
      <!-- remise a disposition button -->
      <!-- author yassine -->
      <button *ngIf="showRemiseDispositionBtn" class="main-btn btn-second" (click)="openRemiseDispositionModal()">
        {{ 'MAKE_AVAILABALITY_BTN' | translate }}
        {{ selectedBal.length === 0 ? totalResult : selectedBal.length }} BALs
      </button>
      <!-- modifier masse bals button -->
      <!-- author yassine -->
      <div *ngIf="showModifEnMassDispositionBtn" class="modifier-mass-bals mbt20">
        <i class="zmdi zmdi-edit"></i>
        <ng-select class="main-btn btn-second" selectedLabel="" [items]="[
            {
              id: 0,
              label:
                'Exporter au forma Excel  ' +
                (selectedBal.length === 0 ? totalResult : selectedBal.length) +
                ' BALs'
            },
            {
              id: 1,
              label:
                'Modifier en masse ' +
                (selectedBal.length === 0 ? totalResult : selectedBal.length) +
                ' BALs'
            },
            {
              id: 2,
              label:
                'Désactiver en masse ' +
                (selectedBal.length === 0 ? totalResult : selectedBal.length) +
                ' BALs'
            }
          ]" bindLabel="label" bindValue="id" (change)="openSidebarCanvas($event)"></ng-select>
      </div>

      <app-template-formulaire *ngIf="isModMassbalsSidBarCanvasOpen"
        [titleFormulaire]="'MOD_MASS_NOTIF_TITLE' | translate" [isFormulaireopen]="isModMassbalsSidBarCanvasOpen"
        (closeFormulaire)="CloseCreateBALForm()">
        <app-modifier-masse-bals [balDataList]="balDataList" (closeEvent)="closeEventHandler($event)" [etatBal]="balFilter.etatBal"
          [filtreAdresse]="adresseHighlight" [identifiantFrontal]="balFilter.identifiantFrontal"
          (MODIF_EN_MASS_EVENT_EMITTER)="MODIF_EN_MASS_EVENT_HANDLER($event)" 
          [balNumber]="
            selectedBal.length === 0 ? totalResult : selectedBal.length
          " [selectedBal]="selectedBal">
        </app-modifier-masse-bals>
      </app-template-formulaire>
    </div>
  </div>
  <!-- ======= START .Bloc MAIN TABLE ======= -->
  <app-letter-box-list #balList [highlighRowEnable]="highlighRowEnable" [frontalRefs]="inputFilterData.frontal"
    [listBAL]="balDataList" [highlight]="highlight" [adresseHighlight]="adresseHighlight"
    [selectedBALList]="selectedBal" (selectedBALEvent)="saveSelectedBAL($event)" (orderingFilter)="updateOrder($event)"
    (updateBALEvent)="editBal($event)"></app-letter-box-list>

  <app-template-formulaire *ngIf="isFormulaireopen" [titleFormulaire]="TitleFormulaire"
    [isFormulaireopen]="isFormulaireopen" (closeFormulaire)="CloseCreateBALForm()">
    <app-formulaire (closeEvent)="CloseCreateBALForm()" (valideCreateBal)="createNewBAL($event)"></app-formulaire>
  </app-template-formulaire>
  <!--formulaire de modification de bal -->
  <app-template-formulaire *ngIf="isUpdateBalFormOpen" [titleFormulaire]="'EDITE_BAL_FORM_TITLE' | translate"
    [isFormulaireopen]="isUpdateBalFormOpen" (closeFormulaire)="closeUpdateForm()">
    <app-update-bal (closeEvent)="closeUpdateForm()" (valideUpdateBal)="updateBal($event)" [bal]="updatedBal">
    </app-update-bal>
  </app-template-formulaire>
  <div class="overley" [ngClass]="
      isUpdateBalFormOpen || isFormulaireopen || isModalOpen ? 'show' : ''
    "></div>
  <app-template-modal *ngIf="isModalDetampoOpen" [TitleModal]="'DETAMPO_MODAL_TITLE' | translate"
    [isModalOpen]="isModalDetampoOpen" (isModalClose)="closeModalDetampo($event)" (valide)="valideDeTempo($event)">
    <app-detamponnage [balFilter]="balFilter" [balNumber]="selectedBal.length === 0 ? totalResult : selectedBal.length"
      [tooltipBALs]="tooltipBALs"></app-detamponnage>
  </app-template-modal>

  <!-- remise a disposition -->
  <!-- author yassine -->
  <app-template-modal *ngIf="showRemiseDispositionModal" [TitleModal]="'REMETTRE_DISPO_MODAL_TITLE' | translate"
    [isModalOpen]="showRemiseDispositionModal" [isValid]="isFormValid"
    (isModalClose)="closeRemiseDispositionModal($event)" (valide)="remise_dispo_submit($event)">
    <app-remise-disposition [balDataList]="balDataList" [selectedBal]="selectedBal"
      [balNumber]="selectedBal.length === 0 ? totalResult : selectedBal.length"
      (REMISE_DISPO_EVENT)="REMISE_DISPO_EVENT_HANDLER($event)"></app-remise-disposition>
  </app-template-modal>

  <!-- desactiver en masse -->
  <!-- author yassine  -->
  <app-template-modal *ngIf="openDescativerEnMassModal" [TitleModal]="'DES_MODAL_TITLE' | translate"
    [isModalOpen]="openDescativerEnMassModal" [isValid]="isDesactiverEnMassFormvalid"
    (isModalClose)="closeDesactiverEnMassModal($event)" (valide)="desactiver_en_mass_submit($event)">
    <app-desactiver-en-mass [selectedBal]="selectedBal"
      [balNumber]="selectedBal.length === 0 ? totalResult : selectedBal.length" [balFilter]="balFilter"
      [balDataList]="balDataList" (DESACTIVER_EN_MASS_EVENT)="DESACTIVER_EN_MASS_EVENT_HANDLER($event)">
    </app-desactiver-en-mass>
  </app-template-modal>

  <div class="flex space-between mgb40">
    <app-pagination *ngIf="isShowPagiantion" [titlePagination]="'MAIL_BOXS' | translate" [totalResult]="totalResult"
      [pageNumber]="balFilter.numeroPage" [pageSiz]="balFilter.nbResultatsParPage"
      (paginationChangeEvent)="getPagination($event)"></app-pagination>
  </div>
</div>
<app-footer></app-footer>